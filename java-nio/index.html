<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Java NIO - zhl&#39;s blog</title><meta name="Description" content="hale&#39;s java note"><meta property="og:title" content="Java NIO" />
<meta property="og:description" content="NIO 1，java NIO概述 替代java io的一个操作 面向缓冲区也可以基于通道操作 更高效的进行文件的读写操作 1.1 阻塞 IO 读或者写数据的时候，会阻塞直" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ylxn-zhl.github.io/java-nio/" /><meta property="og:image" content="https://ylxn-zhl.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-18T18:33:40+08:00" />
<meta property="article:modified_time" content="2021-10-18T18:33:40+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ylxn-zhl.github.io/logo.png"/>

<meta name="twitter:title" content="Java NIO"/>
<meta name="twitter:description" content="NIO 1，java NIO概述 替代java io的一个操作 面向缓冲区也可以基于通道操作 更高效的进行文件的读写操作 1.1 阻塞 IO 读或者写数据的时候，会阻塞直"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://ylxn-zhl.github.io/java-nio/" /><link rel="prev" href="https://ylxn-zhl.github.io/sharding/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Java NIO",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/ylxn-zhl.github.io\/java-nio\/"
        },"genre": "posts","wordcount":  4512 ,
        "url": "https:\/\/ylxn-zhl.github.io\/java-nio\/","datePublished": "2021-10-18T18:33:40+08:00","dateModified": "2021-10-18T18:33:40+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "一路向南-haile"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="zhl&#39;s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/sea.png"
        data-srcset="/images/sea.png, /images/sea.png 1.5x, /images/sea.png 2x"
        data-sizes="auto"
        alt="/images/sea.png"
        title="/images/sea.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="zhl&#39;s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/sea.png"
        data-srcset="/images/sea.png, /images/sea.png 1.5x, /images/sea.png 2x"
        data-sizes="auto"
        alt="/images/sea.png"
        title="/images/sea.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Java NIO</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/ylxn-zhl" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>一路向南-haile</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-10-18">2021-10-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4512 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 10 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="true">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1java-nio概述">1，java NIO概述</a>
      <ul>
        <li><a href="#11-阻塞-io">1.1 阻塞 IO</a></li>
        <li><a href="#12-非阻塞-ionio">1.2 非阻塞 IO（NIO）</a></li>
        <li><a href="#13-nio概念">1.3 NIO概念</a></li>
      </ul>
    </li>
    <li><a href="#2-channel通道">2 Channel（通道）</a>
      <ul>
        <li><a href="#21-filechannel">2.1 FileChannel</a></li>
        <li><a href="#22-其他常用方法">2.2 其他常用方法</a></li>
      </ul>
    </li>
    <li><a href="#23-socket通道">2.3 Socket通道</a>
      <ul>
        <li><a href="#231-serversocketchannel">2.3.1 ServerSocketChannel</a></li>
        <li><a href="#232-socketchannel">2.3.2 SocketChannel</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="nio">NIO</h1>
<h2 id="1java-nio概述">1，java NIO概述</h2>
<ul>
<li>替代java io的一个操作</li>
<li>面向缓冲区也可以基于通道操作</li>
<li>更高效的进行文件的读写操作</li>
</ul>
<h3 id="11-阻塞-io">1.1 阻塞 IO</h3>
<p>读或者写数据的时候，会阻塞直到数据能够正常的读或者写入。在传统的方法中，服务器为客户端建立一个线程，这种模式带来了如果线程增多，大量线程会操成服务器的压力。为了解决这种问题，采用线程池的思想，并设置线程池的大小，但是超出线程数的上限之后的线程就访问不了。</p>
<h3 id="12-非阻塞-ionio">1.2 非阻塞 IO（NIO）</h3>
<p>非阻塞IO指的是IO事件本身不阻塞，是获取IO事件的select()方法是需要阻塞等待的，区别是阻塞IO会阻塞IO操作上，而非阻塞IO阻塞在事件获取上，没有事件就没有IO，select() 阻塞的时候还没有发生，何谈IO阻塞，本质是延迟IO操作，真正发生IO的时候才执行，	而不是发生的时候在阻塞，用Selector负责去监听多个通道，注册感兴趣的特定IO事件，之后系统进行通知。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Users/cenghaile/Documents/zhl/static/image-20211024140913585.png"
        data-srcset="/Users/cenghaile/Documents/zhl/static/image-20211024140913585.png, /Users/cenghaile/Documents/zhl/static/image-20211024140913585.png 1.5x, /Users/cenghaile/Documents/zhl/static/image-20211024140913585.png 2x"
        data-sizes="auto"
        alt="/Users/cenghaile/Documents/zhl/static/image-20211024140913585.png"
        title="image-20211024140913585" /></p>
<p>当有读或写等任何注册的事件发生时，可以从 Selector 中获得相应的 SelectionKey，同时从 SelectionKey 中可以找到发生的事件和该事件所发生的具体的 SelectableChannel，以获得客户端发送过来的数据。</p>
<p></p>
<table>
<thead>
<tr>
<th>IO</th>
<th>NIO</th>
</tr>
</thead>
<tbody>
<tr>
<td>面向流</td>
<td>面向缓冲区</td>
</tr>
<tr>
<td>阻塞IO</td>
<td>非阻塞IO</td>
</tr>
<tr>
<td>无</td>
<td>选择器</td>
</tr>
</tbody>
</table>
<h3 id="13-nio概念">1.3 NIO概念</h3>
<p>Java NIO 由以下几个核心部分组成，还有其他组件（pipe、filelock）</p>
<ul>
<li><strong>Channel</strong>（双向的，既可以用来进行读操作，又可以用来进行写操作）</li>
<li>主要有如下：FileChannel（IO）、DatagramChannel（UDP ）、SocketChannel （TCP中Server ）和 ServerSocketChannel（TCP中Client）。</li>
<li><strong>Buffer</strong>
<ul>
<li>主要有：ByteBuffer, CharBuffer, DoubleBuffer, FloatBuffer,IntBuffer, LongBuffer, ShortBuffer</li>
</ul>
</li>
<li><strong>Selector</strong>（处理多个 Channel）</li>
</ul>
<h2 id="2-channel通道">2 Channel（通道）</h2>
<ul>
<li>可以进行读取和写入，或者进行读取操作，全双工。</li>
<li>操作的数据源可以是多种，比如文件，网络和socket。</li>
<li>Channel 用于在字节缓冲区和位于通道另一侧的实体（通常是一个文件或套接字）之间有效地传输数据</li>
<li>从通道读取数据到缓冲区，从缓冲区写入数据到通道</li>
</ul>
<p>Java NIO类似于流，但又有所不同。</p>
<ul>
<li>既可以从通道中读取数据，又可以写数据到通道。但流的读写通常是单向的。</li>
<li>通道可以异步地读写。</li>
<li>通道中的数据总是要先读到一个 Buffer，或者总是要从一个 Buffer 中写入</li>
</ul>
<p>主要是接口实现，不同操作系统不同接口实现，通过代码也可以看到其代码为接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Channel</span> <span class="kd">extends</span> <span class="n">Closeable</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * Tells whether or not this channel is open.
</span><span class="cm">     *
</span><span class="cm">     * @return &lt;tt&gt;true&lt;/tt&gt; if, and only if, this channel is open
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isOpen</span><span class="o">();</span>
    <span class="cm">/**
</span><span class="cm">     * Closes this channel.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt; After a channel is closed, any further attempt to invoke I/O
</span><span class="cm">     * operations upon it will cause a {@link ClosedChannelException} to be
</span><span class="cm">     * thrown.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt; If this channel is already closed then invoking this method has no
</span><span class="cm">     * effect.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt; This method may be invoked at any time.  If some other thread has
</span><span class="cm">     * already invoked it, however, then another invocation will block until
</span><span class="cm">     * the first invocation is complete, after which it will return without
</span><span class="cm">     * effect. &lt;/p&gt;
</span><span class="cm">     *
</span><span class="cm">     * @throws  IOException  If an I/O error occurs
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>实现接口主要有以下几个常用类：</p>
<ul>
<li>FileChannel 从文件中读写数据。</li>
<li>DatagramChannel 能通过 UDP 读写网络中的数据。</li>
<li>SocketChannel 能通过 TCP 读写网络中的数据。</li>
<li>ServerSocketChannel 可以监听新进来的 TCP 连接，像 Web 服务器那样。对每一个新进来的连接都会创建一个 SocketChannel。</li>
</ul>
<h3 id="21-filechannel">2.1 FileChannel</h3>
<p>主要是文件IO，最常用的一个类。</p>
<p><strong>以下是FileChannel常用的方法</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">int read(ByteBuffer dst)</td>
<td style="text-align:center">从Channel中读取数据到 ByteBuffer</td>
</tr>
<tr>
<td style="text-align:center">long read(ByteBuffer[] dsts)</td>
<td style="text-align:center">将Channel中的数据“分散”到 ByteBuffer[]</td>
</tr>
<tr>
<td style="text-align:center">int write(ByteBuffer src)</td>
<td style="text-align:center">将ByteBuffer中的数据写入到Channel</td>
</tr>
<tr>
<td style="text-align:center">long write(ByteBuffer[] srcs)</td>
<td style="text-align:center">将ByteBuffer[]中的数据“聚集”到Channel</td>
</tr>
<tr>
<td style="text-align:center">long position()</td>
<td style="text-align:center">返回此通道的文件位置</td>
</tr>
<tr>
<td style="text-align:center">FileChannel position(long p）</td>
<td style="text-align:center">设置此通道的文件位置</td>
</tr>
<tr>
<td style="text-align:center">long size()</td>
<td style="text-align:center">返回此通道的文件的当前大小</td>
</tr>
<tr>
<td style="text-align:center">FileChannel truncate(long s)</td>
<td style="text-align:center">将此通道的文件截取为给定大小</td>
</tr>
<tr>
<td style="text-align:center">void force(boolean metaData)</td>
<td style="text-align:center">强制将所有对此通道的文件更新写入到存储设备中</td>
</tr>
</tbody>
</table>
<p><strong>Buffer 通常的操作</strong></p>
<ol>
<li>将数据写入缓冲区</li>
<li>调用 buffer.flip() 反转读写模式</li>
<li>从缓冲区读取数据</li>
<li>调用 buffer.clear() 或 buffer.compact() 清除缓冲区内容</li>
</ol>
<p><strong>部分步骤代码展示：</strong></p>
<ul>
<li>
<p>先打开文件，无法直接打开一个FileChannel，需要通过使用一个 InputStream、OutputStream 或RandomAccessFile 来获取一个 FileChannel。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//创建FileChannel
</span><span class="c1"></span><span class="n">RandomAccessFile</span> <span class="n">aFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="s">&#34;b://1.txt&#34;</span><span class="o">,</span><span class="s">&#34;rw&#34;</span><span class="o">);</span>
<span class="n">FileChannel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">aFile</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>创建Buffer</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">ByteBuffer</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">allocate</span><span class="o">(</span><span class="n">1024</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>从 FileChannel 读取数据read()方法返回的 int 值表示了有多少字节被读到了 Buffer 中。如果返回-1，表示到了文件末尾.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="kt">int</span> <span class="n">bytesRead</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>FileChannel.write()方法向 FileChannel 写数据，该方法的参数是一个 Buffer。在 while 循环中调用的。因为无法保证 write()方法一次能向 FileChannel 写入多少字节，因此需要重复调用 write()方法，直到 Buffer 中已经没有尚未写入通道的字节</p>
</li>
</ul>
<p><strong>读数据主要的代码思路步骤是</strong>：</p>
<ol>
<li>创建一个FileChannel</li>
<li>创建一个数据缓冲区</li>
<li>读取数据到缓冲区中</li>
<li>判断数据是否有，如果有，则取出，判断的依据是获取到的数据是否为-1，取出的数据要先反转读写操作，之后如果数据缓冲区还有，则取出，最后清除数据缓冲区后在判断是否缓冲区还有数据。关闭FileChannel.</li>
</ol>
<p><strong>完整代码展示</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileChannelDemo1</span> <span class="o">{</span>
    <span class="c1">//FileChannel读取数据到buffer中
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">//创建FileChannel
</span><span class="c1"></span>        <span class="n">RandomAccessFile</span> <span class="n">aFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="s">&#34;b://1.txt&#34;</span><span class="o">,</span><span class="s">&#34;rw&#34;</span><span class="o">);</span>
        <span class="n">FileChannel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">aFile</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>

        <span class="c1">//创建Buffer
</span><span class="c1"></span>        <span class="n">ByteBuffer</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">allocate</span><span class="o">(</span><span class="n">1024</span><span class="o">);</span>

        <span class="c1">//读取数据到buffer中
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">bytesRead</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">);</span>
        <span class="k">while</span><span class="o">(</span><span class="n">bytesRead</span> <span class="o">!=</span> <span class="o">-</span><span class="n">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;读取了：&#34;</span><span class="o">+</span><span class="n">bytesRead</span><span class="o">);</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">flip</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">buf</span><span class="o">.</span><span class="na">hasRemaining</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span><span class="n">buf</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
            <span class="n">bytesRead</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">aFile</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;结束了&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>写数据主要代码思路是：</strong></p>
<ol>
<li>创建一个FileChannel</li>
<li>创建一个数据缓冲区</li>
<li>创建要写入的数据对象，以及清空以下缓冲区（防止出错）</li>
<li>要写入的数据写入到缓冲区中</li>
<li>缓冲区读写反转</li>
<li>判断缓冲区是否有数据，将数据一个一个写入到FileChannel</li>
<li>关闭FileChannel</li>
</ol>
<p><strong>完整代码展示：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//FileChanne写操作
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileChannelDemo2</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 打开FileChannel
</span><span class="c1"></span>        <span class="n">RandomAccessFile</span> <span class="n">aFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="s">&#34;b://1.txt&#34;</span><span class="o">,</span><span class="s">&#34;rw&#34;</span><span class="o">);</span>
        <span class="n">FileChannel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">aFile</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>

        <span class="c1">//创建buffer对象
</span><span class="c1"></span>        <span class="n">ByteBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">allocate</span><span class="o">(</span><span class="n">1024</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">newData</span> <span class="o">=</span> <span class="s">&#34;manongyanjiuseng&#34;</span><span class="o">;</span>
        <span class="n">buffer</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

        <span class="c1">//写入内容
</span><span class="c1"></span>        <span class="n">buffer</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">newData</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

        <span class="n">buffer</span><span class="o">.</span><span class="na">flip</span><span class="o">();</span>

        <span class="c1">//FileChannel完成最终实现
</span><span class="c1"></span>        <span class="k">while</span> <span class="o">(</span><span class="n">buffer</span><span class="o">.</span><span class="na">hasRemaining</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">channel</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buffer</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//关闭
</span><span class="c1"></span>        <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22-其他常用方法">2.2 其他常用方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">以下举例的方法有</span><span class="err">：</span>
<span class="n">position</span> 
<span class="n">size</span> 
<span class="n">truncate</span>
<span class="n">force</span>
<span class="n">transferTo</span> <span class="n">和</span> <span class="n">transferFrom</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>position方法</p>
<p>需要在 FileChannel 的某个特定位置进行数据的读/写操作。可以通过调用position()方法获取 FileChannel 的当前位置。也可以通过调用 position(long pos)方法设置 FileChannel 的当前位置</p>
<p>注意这样设置会造成两个后果：
位置如果设置在文件结束符之后，读取数据的文件结束标志返回-1，而且写入数据的时候前面会有间隙，导致文件空洞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">long</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">position</span><span class="o">();</span>
<span class="n">channel</span><span class="o">.</span><span class="na">position</span><span class="o">(</span><span class="n">pos</span> <span class="o">+</span><span class="n">123</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>size方法</p>
<p>返回该实例所关联文件的大小</p>
</li>
<li>
<p>truncate方法</p>
<p>截取一个文件。截取文件时，文件将中指定长度，后面的部分将被删除而且截取的数据长度是以字节截取</p>
</li>
<li>
<p>force方法</p>
<p>尚未写入磁盘的数据强制写到磁盘上</p>
</li>
<li>
<p><strong>transferTo 和 transferFrom 方法</strong></p>
<p>进行通道之间的传输
注意一个To与From的区别，一个主动一个被动</p>
</li>
</ul>
<p>以下是transferFrom 的完整代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//通道之间数据传输
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileChannelDemo3</span> <span class="o">{</span>

    <span class="c1">//transferFrom()
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 创建两个fileChannel
</span><span class="c1"></span>        <span class="n">RandomAccessFile</span> <span class="n">aFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="s">&#34;b://1.txt&#34;</span><span class="o">,</span><span class="s">&#34;rw&#34;</span><span class="o">);</span>
        <span class="n">FileChannel</span> <span class="n">fromChannel</span> <span class="o">=</span> <span class="n">aFile</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>

        <span class="n">RandomAccessFile</span> <span class="n">bFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="s">&#34;b://2.txt&#34;</span><span class="o">,</span><span class="s">&#34;rw&#34;</span><span class="o">);</span>
        <span class="n">FileChannel</span> <span class="n">toChannel</span> <span class="o">=</span> <span class="n">bFile</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>

        <span class="c1">//fromChannel 传输到 toChannel
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">position</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fromChannel</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="n">toChannel</span><span class="o">.</span><span class="na">transferFrom</span><span class="o">(</span><span class="n">fromChannel</span><span class="o">,</span><span class="n">position</span><span class="o">,</span><span class="n">size</span><span class="o">);</span>

        <span class="n">aFile</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">bFile</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;over!&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以下是transferTo的完整代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">//通道之间数据传输
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileChannelDemo4</span> <span class="o">{</span>

    <span class="c1">//transferTo()
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 创建两个fileChannel
</span><span class="c1"></span>        <span class="n">RandomAccessFile</span> <span class="n">aFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="s">&#34;b://1.txt&#34;</span><span class="o">,</span><span class="s">&#34;rw&#34;</span><span class="o">);</span>
        <span class="n">FileChannel</span> <span class="n">fromChannel</span> <span class="o">=</span> <span class="n">aFile</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>

        <span class="n">RandomAccessFile</span> <span class="n">bFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="s">&#34;b://2.txt&#34;</span><span class="o">,</span><span class="s">&#34;rw&#34;</span><span class="o">);</span>
        <span class="n">FileChannel</span> <span class="n">toChannel</span> <span class="o">=</span> <span class="n">bFile</span><span class="o">.</span><span class="na">getChannel</span><span class="o">();</span>

        <span class="c1">//fromChannel 传输到 toChannel
</span><span class="c1"></span>        <span class="kt">long</span> <span class="n">position</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fromChannel</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="n">fromChannel</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">size</span><span class="o">,</span><span class="n">toChannel</span><span class="o">);</span>

        <span class="n">aFile</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">bFile</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;over!&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="23-socket通道">2.3 Socket通道</h2>
<p>所有的 socket 通道类(DatagramChannel、SocketChannel 和 ServerSocketChannel)都继承了位于 java.nio.channels.spi 包中的 AbstractSelectableChannel。这意味着我们可以用一个 Selector 对象来执行socket 通道的就绪选择</p>
<ul>
<li>非阻塞模式中，有更多的伸缩性和灵活性。使用socket，可以用一个线程或者多个线程就可以管理成百上千个socket，管理功能强大，而且没有性能损失，可以通过 Selector监听多个通道</li>
<li>DatagramChannel 和 SocketChannel 实现定义读和写功能的接口而ServerSocketChannel 不实现。ServerSocketChannel 负责监听传入的连接和创建新的 SocketChannel 对象，它本身从不传输数据。究其代码是因为它实现的接口比较少</li>
<li>socket通道可以被重复使用，socket不可以被重复使用</li>
<li>设置socket的通道模式为阻塞还是非阻塞，可以通过AbstractSelectableChannel.java 中实现的 configureBlocking()方法。传递参数值为 true 则设为阻塞模式，参数值为 false 值设为非阻塞模式</li>
</ul>
<h3 id="231-serversocketchannel">2.3.1 ServerSocketChannel</h3>
<ul>
<li>本身不传入数据，主要是为了监听，可以在非阻塞模式下运行</li>
<li>没有bind()绑定方法，通过对等的socket来绑定端口并进行监听
<ul>
<li>ServerSocketChannel的对象.socket().bind();</li>
</ul>
</li>
<li>ServerSocketChannel的对象.socket().bind();</li>
</ul>
<p>其它 Socket 的 accept()方法会阻塞返回一个 Socket 对象。如果ServerSocketChannel 以非阻塞模式被调用，当没有传入连接在等待时，ServerSocketChannel.accept( )会立即返回 null。正是这种检查连接而不阻塞的能力实现了可伸缩性并降低了复杂性。可选择性也因此得到实现。我们可以使用一个选择器实例来注册 ServerSocketChannel 对象以实现新连接到达时自动通知的功能。</p>
<p>具体的代码思路步骤为：</p>
<ul>
<li>打开ServerSocketChannel</li>
<li>绑定端口号</li>
<li>设置非阻塞模式<code>configureBlocking(false);</code></li>
<li>监听连接，通过accept</li>
<li>将其buffer归为0指针<code>rewind()</code>，并且写入buffer</li>
<li>关闭 ServerSocketChannel</li>
</ul>
<p>具体通过代码演示
如下代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerSocketChannelDemo</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">//端口号
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">8888</span><span class="o">;</span>

        <span class="c1">//buffer
</span><span class="c1"></span>        <span class="n">ByteBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="s">&#34;hello atguigu&#34;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

        <span class="c1">//ServerSocketChannel
</span><span class="c1"></span>        <span class="n">ServerSocketChannel</span> <span class="n">ssc</span> <span class="o">=</span> <span class="n">ServerSocketChannel</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
        <span class="c1">//绑定
</span><span class="c1"></span>        <span class="n">ssc</span><span class="o">.</span><span class="na">socket</span><span class="o">().</span><span class="na">bind</span><span class="o">(</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span><span class="n">port</span><span class="o">));</span>

        <span class="c1">//设置非阻塞模式
</span><span class="c1"></span>        <span class="n">ssc</span><span class="o">.</span><span class="na">configureBlocking</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

        <span class="c1">//监听有新链接传入
</span><span class="c1"></span>        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Waiting for connections&#34;</span><span class="o">);</span>
            <span class="n">SocketChannel</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">ssc</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">sc</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//没有链接传入
</span><span class="c1"></span>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;null&#34;</span><span class="o">);</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Incoming connection from: &#34;</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="na">socket</span><span class="o">().</span><span class="na">getRemoteSocketAddress</span><span class="o">());</span>
                <span class="n">buffer</span><span class="o">.</span><span class="na">rewind</span><span class="o">();</span> <span class="c1">//指针0
</span><span class="c1"></span>                <span class="n">sc</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buffer</span><span class="o">);</span>
                <span class="n">sc</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>通过浏览器点击127.0.0.1:8888，就会出现监听的提示</p>
<h3 id="232-socketchannel">2.3.2 SocketChannel</h3>
<ul>
<li>用于连接到TCP的套接字</li>
<li>实现多路复用</li>
<li>面向缓冲区</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">主要的特征有：
（1）对于已经存在的 socket 不能创建 SocketChannel
（2）SocketChannel 中提供的 open 接口创建的 Channel 并没有进行网络级联，需要使用 connect 接口连接到指定地址
（3）未进行连接的 SocketChannle 执行 I/O 操作时，会抛出
NotYetConnectedException
（4）SocketChannel 支持两种 I/O 模式：阻塞式和非阻塞式
（5）SocketChannel 支持异步关闭。如果 SocketChannel 在一个线程上 <span class="nb">read</span> 阻塞，另一个线程对该 SocketChannel 调用 shutdownInput，则读阻塞的线程将返回-1 表示没有读取任何数据；如果 SocketChannel 在一个线程上 write 阻塞，另一个线程对该SocketChannel 调用 shutdownWrite，则写阻塞的线程将抛出AsynchronousCloseException
（6）
SocketChannel 支持设定参数
SO_SNDBUF 套接字发送缓冲区大小
SO_RCVBUF 套接字接收缓冲区大小
SO_KEEPALIVE 保活连接
O_REUSEADDR 复用地址
SO_LINGER 有数据传输时延缓关闭 Channel <span class="o">(</span>只有在非阻塞模式下有用<span class="o">)</span>
TCP_NODELAY 禁用 Nagle 算法
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-10-18</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/java-nio/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://ylxn-zhl.github.io/java-nio/" data-title="Java NIO" data-via="xxxx"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://ylxn-zhl.github.io/java-nio/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://ylxn-zhl.github.io/java-nio/" data-title="Java NIO"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://ylxn-zhl.github.io/java-nio/" data-title="Java NIO"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://ylxn-zhl.github.io/java-nio/" data-title="Java NIO" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://ylxn-zhl.github.io/java-nio/" data-title="Java NIO" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://ylxn-zhl.github.io/java-nio/" data-title="Java NIO"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://ylxn-zhl.github.io/java-nio/" data-title="Java NIO"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/sharding/" class="prev" rel="prev" title="Sharding"><i class="fas fa-angle-left fa-fw"></i>Sharding</a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.88.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/ylxn-zhl" target="_blank">一路向南-haile</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="https://.disqus.com/embed.js" defer></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
